const API_URL="https://api.jsonbin.io/v3/b/67d2aaa98960c979a570ade7",API_KEY="$2a$10$3jXtFCWAVo8McpPR7Ib1ZuTtkYiKoj3H3H0VmRY8SKmd2jI7myboS";let prohibitedWords=null;async function loadProhibitedWords(){try{const e=await fetch("../data/prohibited-words.json");if(!e.ok)throw new Error("Failed to load prohibited words");prohibitedWords=await e.json()}catch(e){console.error("Error loading prohibited words:",e),prohibitedWords={profanity:[],hateAndDiscrimination:[],spam:[],spamPatterns:[]}}}function sanitizeInput(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function containsOffensiveContent(e){if(!prohibitedWords)return!1;const t=e.toLowerCase();return!!prohibitedWords.profanity.some(e=>t.includes(e))||(!!prohibitedWords.hateAndDiscrimination.some(e=>t.includes(e))||(!!prohibitedWords.spam.some(e=>t.includes(e))||prohibitedWords.spamPatterns.some(e=>new RegExp(e).test(t))))}function validateInput(e,t){if(!e||""===e.trim())throw new Error(`${t} cannot be empty`);if("name"===t&&e.length>50)throw new Error("Name is too long (maximum 50 characters)");if("comment"===t&&e.length>500)throw new Error("Comment is too long (maximum 500 characters)");if(containsOffensiveContent(e))throw new Error(`Your ${t} contains inappropriate content`);return sanitizeInput(e)}document.addEventListener("DOMContentLoaded",async function(){await loadProhibitedWords();const e=document.getElementById("comment-form"),t=document.getElementById("comments-container");function n(e){t.innerHTML="",e.forEach(e=>{const n=document.createElement("div");n.className="comment",n.innerHTML=`<h4>${e.name}</h4><p>${e.comment}</p>`,t.appendChild(n)})}e.addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("name"),o=document.getElementById("comment"),r={name:t.value,comment:o.value};await async function(e){try{const t={name:validateInput(e.name,"name"),comment:validateInput(e.comment,"comment")},o=await fetch(API_URL,{method:"GET",headers:{"X-Master-Key":API_KEY}});let r=(await o.json()).record||[];r.push(t),await fetch(API_URL,{method:"PUT",headers:{"Content-Type":"application/json","X-Master-Key":API_KEY},body:JSON.stringify(r)}),n(r)}catch(e){console.error("Error:",e.message),alert(e.message)}}(r),t.value="",o.value=""}),async function(){try{const e=await fetch(API_URL,{method:"GET",headers:{"X-Master-Key":API_KEY}});if(!e.ok)throw new Error("No comments found");n((await e.json()).record)}catch(e){console.log("No comments yet"),t.innerHTML='<p class="no-comments">Be the first to leave a comment!</p>'}}()});